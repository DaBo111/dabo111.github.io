{% if site.show_os_projects %}
  <h1 class="title">{{site.os_projects_title}}</h1>
  
  <!-- Project Category Filters -->
  <div class="project-filters">
    <button class="project-filter-btn active" data-category="all">All</button>
    <button class="project-filter-btn" data-category="others">Others</button>
    <!-- Additional categories will be added dynamically -->
  </div>
  
  {% if site.projects.sort_by == 'stars' %}
    {% assign sort_order = 'stargazers_count', 'last' %}
  {% else %}
    {% assign sort_order = 'pushed_at' %}
  {% endif %}

  {% if site.projects.exclude.archived && site.projects.exclude.forks %}
    {% assign filtered_repos = site.github.public_repositories | where:'archived', false | sort: sort_order | reverse %}
    {% assign filtered_repos = filtered_repos | where:'fork', false %}
    {% comment %} Include template repositories even if they're marked as forks {% endcomment %}
    {% assign template_repos = site.github.public_repositories | where:'is_template', true | where:'archived', false %}
    {% assign filtered_repos = filtered_repos | concat: template_repos | uniq %}
  {% elsif site.projects.exclude.archived %}
    {% assign filtered_repos = site.github.public_repositories | where:'archived', false | sort: sort_order | reverse %}
  {% elsif site.projects.exclude.forks %}
    {% assign filtered_repos = site.github.public_repositories | where:'archived', false | sort: sort_order | reverse %}
    {% assign filtered_repos = filtered_repos | where:'fork', false %}
    {% comment %} Include template repositories even if they're marked as forks {% endcomment %}
    {% assign template_repos = site.github.public_repositories | where:'is_template', true | where:'archived', false %}
    {% assign filtered_repos = filtered_repos | concat: template_repos | uniq %}
  {% else %}
    {% assign filtered_repos = site.github.public_repositories | sort: sort_order | reverse %}
  {% endif %}

  <div class="projects-wrapper">
    {% for repository in filtered_repos %}
      {% unless site.projects.exclude.projects contains repository.name %}
        {% assign project_data = site.data.project_titles[repository.name] %}
        
        {% comment %} Handle different data formats and apply defaults {% endcomment %}
        {% if project_data.title or project_data.description or project_data.image or project_data.category %}
          {% comment %} New format: object with properties {% endcomment %}
          {% assign custom_title = project_data.title | default: repository.name %}
          {% assign custom_description = project_data.description | default: repository.description %}
          {% assign custom_image = project_data.image %}
          {% assign custom_category = project_data.category | default: "Others" %}
        {% elsif project_data %}
          {% comment %} Old format: string title only {% endcomment %}
          {% assign custom_title = project_data %}
          {% assign custom_description = repository.description %}
          {% assign custom_image = nil %}
          {% assign custom_category = "Others" %}
        {% else %}
          {% comment %} No custom data available - use all defaults {% endcomment %}
          {% assign custom_title = repository.name %}
          {% assign custom_description = repository.description %}
          {% assign custom_image = nil %}
          {% assign custom_category = "Others" %}
        {% endif %}
        
        {% assign display_category = custom_category %}
        
        <div class="project neumorphism-card{% if custom_image %} project-with-image{% endif %}" data-aos="zoom-in-down" data-category="{{ display_category | downcase | replace: ' ', '-' }}">
          
          <!-- Top left: Category info (like research publication-info) -->
          <div class="project-header">
            <div class="category-info">
              <span class="category-icon" title="{{ display_category }}">üìÅ</span>
              <span class="category-label">{{ display_category }}</span>
            </div>
          </div>
          
          <!-- Top right: Project image -->
          {% if custom_image %}
          <div class="project-image">
            <img src="{{ custom_image }}" alt="{{ custom_title }}" loading="lazy">
          </div>
          {% endif %}
          
          <div class="name-link-wrapper">
            <h3>{{ custom_title }}</h3>
            <div class="links">
              {% if repository.stargazers_count != 0 %}
                <a href="{{ repository.html_url }}/stargazers" class="project-stars-forks">
                  <svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                    <path fill-rule="evenodd" d="M14 6l-4.9-.64L7 1 4.9 5.36 0 6l3.6 3.26L2.67 14 7 11.67 11.33 14l-.93-4.74L14 6z">
                    </path>
                  </svg>{{ repository.stargazers_count }}
                </a>
                {% endif %}
                {% if repository.forks_count != 0 %}
                <a href="{{ repository.html_url }}/network/members" class="project-stars-forks">
                  <svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                    <path fill-rule="evenodd"
                      d="M10 5c0-1.11-.89-2-2a1.993 1.993 0 0 0-1 3.72v.3c-.02.52-.23.98-.63 1.38-.4.4-.86.61-1.38.63-.83.02-1.48.16-2 .45V4.72a1.993 1.993 0 0 0-1-3.72C.88 1 0 1.89 0 3a2 2 0 0 0 1 1.72v6.56c-.59.35-1 .99-1 1.72 0 1.11.89 2 2 2 1.11 0 2-.89 2-2 0-.53-.2-1-.53-1.36.09-.06.48-.41.59-.47.25-.11.56-.17.94-.17 1.05-.05 1.95-.45 2.75-1.25S8.95 7.77 9 6.73h-.02C9.59 6.37 10 5.73 10 5zM2 1.8c.66 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2C1.35 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2zm0 12.41c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm6-8c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z">
                    </path>
                  </svg>{{ repository.forks_count }}
                </a>
              {% endif %}
            </div>
          </div>
          
          <!-- Description (full text, no expand/collapse) -->
          <div class="project-desc-wrapper">
            <p class="project-desc">
              {{ custom_description | default: repository.description }}
            </p>
          </div>
          
          <div class="project-links">
            {% if repository.homepage != "" and repository.homepage != nil %}
              <a class="highlight-link" href="{{repository.homepage}}" target="_blank" rel="noreferrer">
                Demo
              </a>
            {% endif %}
            <a class="highlight-link" href="{{repository.html_url}}" target="_blank" rel="noreferrer">
              Github
            </a>
          </div>
          
          {% if repository.topics %}
            <div class="tag-wrapper">
              {% for topic in repository.topics %}
                <span class="tag neumorphism-card">{{topic}}</span>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      {% endunless %}
    {% endfor %}
  </div>
{% endif %}